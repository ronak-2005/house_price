<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>House Price Predictor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.4; }
    }

    .fade-in { animation: fadeIn 0.5s ease-out; }
    .slide-down { animation: slideDown 0.4s ease-out; }
    .pulse-dot { animation: pulse 1.2s infinite; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

  <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md fade-in">
    
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-4xl mb-3">üè†</div>
      <h1 class="text-2xl font-semibold text-indigo-600 mb-2">
        House Price Batch Prediction
      </h1>
    </div>

    <!-- Upload Form -->
    <form id="uploadForm" class="space-y-6">
      <div class="text-center">
        <input id="fileInput" type="file" accept=".csv" required class="hidden">
        <label for="fileInput" 
               class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md 
                      text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 
                      cursor-pointer transition-colors">
          Choose file
        </label>
        <span id="fileName" class="ml-3 text-sm text-gray-500">test.csv</span>
      </div>
      
      <div class="text-center">
        <button id="submitBtn" type="submit"
                class="px-8 py-3 bg-indigo-600 text-white rounded-md font-medium
                       hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed
                       transition-colors">
          Upload & Predict
        </button>
      </div>
    </form>

    <!-- Loading -->
    <div id="loadingSection" class="hidden mt-6 text-center slide-down">
      <div class="flex justify-center items-center space-x-1">
        <div class="w-2 h-2 bg-indigo-500 rounded-full pulse-dot" style="animation-delay: 0s"></div>
        <div class="w-2 h-2 bg-indigo-500 rounded-full pulse-dot" style="animation-delay: 0.2s"></div>
        <div class="w-2 h-2 bg-indigo-500 rounded-full pulse-dot" style="animation-delay: 0.4s"></div>
      </div>
      <p class="text-sm text-gray-600 mt-2">Processing...</p>
    </div>

    <!-- Error -->
    <div id="errorSection" class="hidden mt-6 slide-down">
      <div class="p-3 bg-red-50 border border-red-200 rounded-md">
        <p class="text-sm text-red-600" id="errorMessage"></p>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsSection" class="hidden mt-6 slide-down">
      <h3 class="text-lg font-medium text-gray-900 mb-3">Results</h3>
      <div class="bg-gray-50 rounded-md p-3">
        <div class="space-y-2" id="resultsBody">
          <!-- Results will be inserted here -->
        </div>
      </div>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('uploadForm');
      const fileInput = document.getElementById('fileInput');
      const fileName = document.getElementById('fileName');
      const submitBtn = document.getElementById('submitBtn');
      const loadingSection = document.getElementById('loadingSection');
      const resultsSection = document.getElementById('resultsSection');
      const errorSection = document.getElementById('errorSection');
      const errorMessage = document.getElementById('errorMessage');
      const resultsBody = document.getElementById('resultsBody');

      // File selection
      fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        fileName.textContent = file ? file.name : 'No file chosen';
      });

      // Form submission
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!fileInput.files[0]) {
          showError('Please select a CSV file');
          return;
        }
        
        hideResults();
        hideError();
        showLoading();
        
        try {
          const formData = new FormData();
          formData.append('file', fileInput.files[0]);
          
          const response = await fetch('/predict_csv', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Upload failed');
          }
          
          const result = await response.json();
          
          if (result.predictions && result.predictions.length > 0) {
            displayResults(result.predictions);
          } else {
            throw new Error('No predictions received');
          }
          
        } catch (error) {
          showError(error.message);
        } finally {
          hideLoading();
        }
      });

      function showLoading() {
        loadingSection.classList.remove('hidden');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';
      }

      function hideLoading() {
        loadingSection.classList.add('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Upload & Predict';
      }

      function showError(message) {
        errorMessage.textContent = message;
        errorSection.classList.remove('hidden');
      }

      function hideError() {
        errorSection.classList.add('hidden');
      }

      function displayResults(predictions) {
        resultsBody.innerHTML = '';
        
        predictions.slice(0, 5).forEach(row => {
          const div = document.createElement('div');
          div.className = 'flex justify-between text-sm';
          div.innerHTML = `
            <span class="text-gray-600">Row ${row.index}:</span>
            <span class="font-medium text-gray-900">$${row['Predicted Price'].toLocaleString()}</span>
          `;
          resultsBody.appendChild(div);
        });
        
        resultsSection.classList.remove('hidden');
      }

      function hideResults() {
        resultsSection.classList.add('hidden');
      }
    });
  </script>
</body>
</html>